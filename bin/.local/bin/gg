#!/bin/bash

export INITIAL_QUERY=""
export RG_PREFIX="rg --ignore --hidden --column --line-number --with-filename --no-heading --color=always --smart-case "
export FZF_DEFAULT_COMMAND="$RG_PREFIX '$INITIAL_QUERY'"
selected=$(fzf \
  --bind "change:reload:$RG_PREFIX {q} || true" \
  --disabled \
  --ansi \
  --query "$INITIAL_QUERY" \
  --height=50% \
  --tabstop=2 \
  --layout=reverse \
  --nth=2 \
  --delimiter : \
  --preview-window "+{2}/2" \
  --preview "bat \
    --style=numbers \
    -r {2}: \
    -H {2} \
    --line-range :500 {1}")

# Check that the string is not empty
if not test -z $selected; then
  nvim -c +"edit $selected"
fi
